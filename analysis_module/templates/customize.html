{% extends 'template.html' %}
{% block title %} Analysis {% endblock %}
{% block content %}
{% load plotly_dash %}
{% load bootstrap_icons %}
<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
    <div class="d-flex justify-content-center align-items-center">
        <div class="col-md-6">
            <h2 class="text-center" style="margin: 20px;">Customize charts</h2>
            <div class="row justify-content-center">
                <div class="col-md-12">
                    <form id="chartForm" action="{% url 'analysis:customize_chart' %}" method="POST">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="input_typeChart" class="form-label">Chart Type</label>
                            <select class="form-select" id="input_category" name="chart_type" required
                                aria-label="select example">
                                <option value="0">Open this select menu</option>
                                <option value="1">Pie Chart</option>
                                <option value="2">Bar Chart</option>
                            </select>
                            <div class="invalid-feedback">Example invalid select feedback</div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Variables</label>
                            <!-- Variables section -->
                            <div class="variables-section">
                                <div class="form-check">
                                    <input class="form-check-input variable-checkbox" type="checkbox" value="1" id="var1" name="variables" data-variable="products_sold">
                                    <label class="form-check-label" for="var1">
                                        Products sold
                                    </label>
                                    <!-- Categories for Products sold -->
                                    <div class="categories-section ms-4 d-none" id="categories1">
                                        <small class="text-muted d-block mb-2">Optional: Select specific categories or leave empty for all</small>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories1" value="Fast Food">
                                            <label class="form-check-label">Fast Food</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories1" value="Healthy Options">
                                            <label class="form-check-label">Healthy Options</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories1" value="Grilled & BBQ">
                                            <label class="form-check-label">Grilled & BBQ</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories1" value="Sides">
                                            <label class="form-check-label">Sides</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories1" value="Beverages">
                                            <label class="form-check-label">Beverages</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories1" value="Desserts">
                                            <label class="form-check-label">Desserts</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input variable-checkbox" type="checkbox" value="2" id="var2" name="variables" data-variable="products_donated">
                                    <label class="form-check-label" for="var2">
                                        Products donated
                                    </label>
                                    <div class="categories-section ms-4 d-none" id="categories2">
                                        <small class="text-muted d-block mb-2">Optional: Select specific categories or leave empty for all</small>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories2" value="Fast Food">
                                            <label class="form-check-label">Fast Food</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories2" value="Healthy Options">
                                            <label class="form-check-label">Healthy Options</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories2" value="Grilled & BBQ">
                                            <label class="form-check-label">Grilled & BBQ</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories2" value="Sides">
                                            <label class="form-check-label">Sides</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories2" value="Beverages">
                                            <label class="form-check-label">Beverages</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories2" value="Desserts">
                                            <label class="form-check-label">Desserts</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input variable-checkbox" type="checkbox" value="3" id="var3" name="variables" data-variable="products_donated">
                                    <label class="form-check-label" for="var3">
                                        Products in inventory
                                    </label>
                                    <div class="categories-section ms-4 d-none" id="categories3">
                                        <small class="text-muted d-block mb-2">Optional: Select specific categories or leave empty for all</small>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories3" value="Fast Food">
                                            <label class="form-check-label">Fast Food</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories3" value="Healthy Options">
                                            <label class="form-check-label">Healthy Options</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories3" value="Grilled & BBQ">
                                            <label class="form-check-label">Grilled & BBQ</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories3" value="Sides">
                                            <label class="form-check-label">Sides</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories3" value="Beverages">
                                            <label class="form-check-label">Beverages</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories3" value="Desserts">
                                            <label class="form-check-label">Desserts</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input variable-checkbox" type="checkbox" value="4" id="var4" name="variables" data-variable="products_donated">
                                    <label class="form-check-label" for="var4">
                                        Products published
                                    </label>
                                    <div class="categories-section ms-4 d-none" id="categories4">
                                        <small class="text-muted d-block mb-2">Optional: Select specific categories or leave empty for all</small>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories4" value="Fast Food">
                                            <label class="form-check-label">Fast Food</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories4" value="Healthy Options">
                                            <label class="form-check-label">Healthy Options</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories4" value="Grilled & BBQ">
                                            <label class="form-check-label">Grilled & BBQ</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories4" value="Sides">
                                            <label class="form-check-label">Sides</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories4" value="Beverages">
                                            <label class="form-check-label">Beverages</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories4" value="Desserts">
                                            <label class="form-check-label">Desserts</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input variable-checkbox" type="checkbox" value="5" id="var5" name="variables" data-variable="products_donated">
                                    <label class="form-check-label" for="var5">
                                        Products published for sale
                                    </label>
                                    <div class="categories-section ms-4 d-none" id="categories5">
                                        <small class="text-muted d-block mb-2">Optional: Select specific categories or leave empty for all</small>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories5" value="Fast Food">
                                            <label class="form-check-label">Fast Food</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories5" value="Healthy Options">
                                            <label class="form-check-label">Healthy Options</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories5" value="Grilled & BBQ">
                                            <label class="form-check-label">Grilled & BBQ</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories5" value="Sides">
                                            <label class="form-check-label">Sides</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories5" value="Beverages">
                                            <label class="form-check-label">Beverages</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories5" value="Desserts">
                                            <label class="form-check-label">Desserts</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input variable-checkbox" type="checkbox" value="6" id="var6" name="variables" data-variable="products_donated">
                                    <label class="form-check-label" for="var6">
                                        Products published for donate
                                    </label>
                                    <div class="categories-section ms-4 d-none" id="categories6">
                                        <small class="text-muted d-block mb-2">Optional: Select specific categories or leave empty for all</small>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories6" value="Fast Food">
                                            <label class="form-check-label">Fast Food</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories6" value="Healthy Options">
                                            <label class="form-check-label">Healthy Options</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories6" value="Grilled & BBQ">
                                            <label class="form-check-label">Grilled & BBQ</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories6" value="Sides">
                                            <label class="form-check-label">Sides</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories6" value="Beverages">
                                            <label class="form-check-label">Beverages</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories6" value="Desserts">
                                            <label class="form-check-label">Desserts</label>
                                        </div>
                                    </div>
                                </div>


                                <div class="form-check">
                                    <input class="form-check-input variable-checkbox" type="checkbox" value="7" id="var7" name="variables" data-variable="products_donated">
                                    <label class="form-check-label" for="var7">
                                        Products wasted
                                    </label>
                                    <div class="categories-section ms-4 d-none" id="categories7">
                                        <small class="text-muted d-block mb-2">Optional: Select specific categories or leave empty for all</small>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories7" value="Fast Food">
                                            <label class="form-check-label">Fast Food</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories7" value="Healthy Options">
                                            <label class="form-check-label">Healthy Options</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories7" value="Grilled & BBQ">
                                            <label class="form-check-label">Grilled & BBQ</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories7" value="Sides">
                                            <label class="form-check-label">Sides</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories7" value="Beverages">
                                            <label class="form-check-label">Beverages</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="categories7" value="Desserts">
                                            <label class="form-check-label">Desserts</label>
                                        </div>
                                    </div>
                                </div>

                                
                            </div>
                        </div>

                        <div class="mb-3 d-grid gap-2">
                            <button class="btn customize_btn" type="submit">Customize</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {% if is_chart == 1 %}
    <!-- Summary Table -->
    <div class="card mt-4">
        <div class="card-header">
            Summary Table
        </div>
        <div class="card-body">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Variable</th>
                        <th scope="col">Count</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in summary_data %}
                    <tr>
                        <td>{{ item.0 }}</td>
                        <td>{{ item.1 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    
    <div class="card mt-4">
        <div class="card-header">
            Customized Chart
        </div>
        <div class="card-body">
            <div class="{% plotly_class name='BarChart' %} card" style="height: 100%; width: 100%;">
                {{ chart|safe }}
            </div>
        </div>
    </div>
    {% endif %}
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle showing/hiding category sections
    const variableCheckboxes = document.querySelectorAll('.variable-checkbox');
    
    variableCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const categoriesSection = document.getElementById('categories' + this.value);
            if (this.checked) {
                categoriesSection.classList.remove('d-none');
            } else {
                categoriesSection.classList.add('d-none');
                // Uncheck all category checkboxes when variable is unchecked
                const categoryCheckboxes = categoriesSection.querySelectorAll('input[type="checkbox"]');
                categoryCheckboxes.forEach(cb => cb.checked = false);
            }
        });
    });

    // Form validation
    document.getElementById('chartForm').addEventListener('submit', function(event) {
        const chartType = document.getElementById('input_category').value;
        const variableCheckboxes = document.querySelectorAll('.variable-checkbox:checked');
        
        if (chartType === "0" || variableCheckboxes.length < 1) {
            event.preventDefault();
            alert('Please select a chart type and at least one variable.');
            return;
        }
    });
});
</script>
{% endblock %}